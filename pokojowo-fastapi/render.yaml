# Render Blueprint - Pokojowo FastAPI Backend
# https://render.com/docs/blueprint-spec

services:
  # ===========================================
  # FastAPI Backend Service
  # ===========================================
  - type: web
    name: pokojowo-api
    runtime: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    region: frankfurt  # EU region for lower latency
    plan: starter  # or free for testing

    # Health check
    healthCheckPath: /health

    # Scaling (adjust based on traffic)
    scaling:
      minInstances: 1
      maxInstances: 3
      targetMemoryPercent: 80
      targetCPUPercent: 70

    # Environment variables
    envVars:
      # Server
      - key: PORT
        value: 10000
      - key: DEBUG
        value: false
      - key: GUNICORN_WORKERS
        value: 2

      # Database (set in Render dashboard)
      - key: MONGODB_URL
        sync: false

      # Security (set in Render dashboard)
      - key: SECRET_KEY
        generateValue: true
      - key: ACCESS_TOKEN_SECRET
        generateValue: true
      - key: REFRESH_TOKEN_SECRET
        generateValue: true

      # Google OAuth (set in Render dashboard)
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        sync: false

      # Frontend URL (set in Render dashboard)
      - key: FRONTEND_URL
        sync: false

      # CORS
      - key: CORS_ORIGINS
        sync: false

      # Email (set in Render dashboard)
      - key: EMAIL_USER
        sync: false
      - key: EMAIL_PASS
        sync: false

      # Performance
      - key: PYTHONOPTIMIZE
        value: 2
      - key: MONGODB_MAX_POOL_SIZE
        value: 50
      - key: MONGODB_MIN_POOL_SIZE
        value: 10

    # Auto-deploy on push
    autoDeploy: true

    # Build filter - only deploy on backend changes
    buildFilter:
      paths:
        - pokojowo-fastapi/**
